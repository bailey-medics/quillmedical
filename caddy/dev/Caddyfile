:80 {
  encode zstd gzip

  # 1) API requests → backend
  @api path /api/*
  handle @api {
    reverse_proxy backend:8000
  }

  # 2) SPA served under `/app` and `/app/*` → preserve the `/app` prefix when
  # proxying to the frontend dev server. Vite is configured with base `/app/`,
  # so forwarding the original path prevents redirect loops.
  handle /app/* {
    reverse_proxy frontend:5173
  }

  # 3) Everything else → public pages dev server
  handle {
    reverse_proxy frontend:5174
  }
}